<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/worldview/lessons"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ entry?.source?.title || 'Worldview Entry' }}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [value]="mode" (ionChange)="setMode($event.detail.value)">
      <ion-segment-button value="view" [disabled]="!entry">
        <ion-label>View</ion-label>
      </ion-segment-button>
      <ion-segment-button value="edit" [disabled]="!entry">
        <ion-label>Edit</ion-label>
      </ion-segment-button>
      <ion-segment-button value="capture">
        <ion-label>Capture</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="mode === 'view' && entry as e">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Source</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{ e.source.creator }} â€¢ {{ e.source.kind }}</p>
        <p class="ion-text-wrap">{{ e.source.url }}</p>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Summary</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{ e.summary.one_line }}</p>
        <p class="ion-text-wrap">{{ e.summary.short }}</p>
        <div class="chip-row">
          <ion-chip *ngFor="let tag of e.summary.tags">
            <ion-label>{{ tag }}</ion-label>
          </ion-chip>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Key Units</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item *ngFor="let unit of e.units">
          <ion-label>
            <h3>{{ unit.type }}</h3>
            <p>{{ unit.text }}</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <ng-container *ngIf="mode === 'edit' && entry as e">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Source</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-input label="Title" [value]="e.source.title"></ion-input>
        <ion-input label="Creator" [value]="e.source.creator"></ion-input>
        <ion-input label="Kind" [value]="e.source.kind"></ion-input>
        <ion-input label="URL" [value]="e.source.url"></ion-input>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Summary</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-input label="One-line" [value]="e.summary.one_line"></ion-input>
        <ion-textarea label="Short" [value]="e.summary.short"></ion-textarea>
        <div class="chip-row">
          <ion-chip *ngFor="let tag of e.summary.tags">
            <ion-label>{{ tag }}</ion-label>
          </ion-chip>
          <ion-button size="small" fill="outline">+ Tag</ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Units</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item *ngFor="let unit of e.units">
          <ion-label>
            <h3>{{ unit.type }}</h3>
            <p>{{ unit.text }}</p>
          </ion-label>
          <ion-button fill="outline" size="small">+ Evidence</ion-button>
        </ion-item>
        <ion-button expand="block" fill="outline">+ Add Unit</ion-button>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <ng-container *ngIf="mode === 'capture'">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Quick Capture</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-select label="Kind" [(ngModel)]="captureDraft.kind">
          <ion-select-option value="debate">debate</ion-select-option>
          <ion-select-option value="book">book</ion-select-option>
          <ion-select-option value="paper">paper</ion-select-option>
          <ion-select-option value="podcast">podcast</ion-select-option>
          <ion-select-option value="movie">movie</ion-select-option>
          <ion-select-option value="video">video</ion-select-option>
          <ion-select-option value="article">article</ion-select-option>
          <ion-select-option value="tweet">tweet</ion-select-option>
          <ion-select-option value="tiktok">tiktok</ion-select-option>
          <ion-select-option value="org">org</ion-select-option>
          <ion-select-option value="thinktank">thinktank</ion-select-option>
          <ion-select-option value="website">website</ion-select-option>
          <ion-select-option value="course">course</ion-select-option>
        </ion-select>
        <ion-input label="Title" [(ngModel)]="captureDraft.title"></ion-input>
        <ion-input label="Creator" [(ngModel)]="captureDraft.creator"></ion-input>
        <ion-input label="URL" [(ngModel)]="captureDraft.url"></ion-input>
        <ion-input label="One-line" [(ngModel)]="captureDraft.oneLine"></ion-input>
        <ion-select label="Unit type" [(ngModel)]="captureDraft.unitType">
          <ion-select-option value="claim">claim</ion-select-option>
          <ion-select-option value="argument">argument</ion-select-option>
          <ion-select-option value="definition">definition</ion-select-option>
          <ion-select-option value="scene">scene</ion-select-option>
          <ion-select-option value="theme">theme</ion-select-option>
        </ion-select>
        <ion-input label="Unit text" [(ngModel)]="captureDraft.unitText"></ion-input>
        <ion-button expand="block" class="ion-margin-top" (click)="saveDraft()">Save Draft</ion-button>
      </ion-card-content>
    </ion-card>
  </ng-container>
</ion-content>
