<section class="study-tab study-tab--comprehension">
  <app-targeted-notes-panel
    *ngIf="taskTarget as target"
    class="study-targeted-notes"
    [target]="target"
    placeholder="Capture a comprehension note..."
  ></app-targeted-notes-panel>

  <ion-accordion-group class="study-accordion" *ngIf="groups.length; else noComprehensionGroups">
    <ion-accordion
      class="study-accordion-item"
      *ngFor="let group of groups; let groupIndex = index"
      [value]="group.id"
      [attr.data-accent]="group.accent"
    >
      <ion-item slot="header" class="study-accordion-header">
        <ion-label>{{ group.title }}</ion-label>
        <ion-note slot="end">{{ group.questions.length }}</ion-note>
      </ion-item>

      <div slot="content" class="study-accordion-content">
        <ion-list class="study-list" lines="none">
          <ng-container *ngFor="let question of group.questions; let questionIndex = index">
            <ion-item class="study-item study-item--question" lines="none">
              <ion-label>{{ questionIndex + 1 }}. {{ question }}</ion-label>
              <ion-button
                slot="end"
                fill="clear"
                size="small"
                (click)="toggleQuestionNotes($event, groupIndex, questionIndex)"
              >
                Notes
              </ion-button>
            </ion-item>

            <app-targeted-notes-panel
              *ngIf="activeQuestionKey === questionKey(groupIndex, questionIndex) && activeQuestionTarget"
              class="study-targeted-notes study-targeted-notes--inline"
              [target]="activeQuestionTarget!"
              placeholder="Add a note for this question..."
            ></app-targeted-notes-panel>
          </ng-container>
        </ion-list>
      </div>
    </ion-accordion>
  </ion-accordion-group>

  <ng-template #noComprehensionGroups>
    <p class="study-empty">No comprehension prompts available.</p>
  </ng-template>
</section>
