<ion-header class="study-toolbar-wrap">
  <ion-toolbar class="study-toolbar">
    <ion-buttons slot="start">
      <ion-button class="study-back-button" fill="clear" (click)="back()" aria-label="Back to lessons">
        <ion-icon [icon]="icons.arrowBackOutline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="study-content" [fullscreen]="true">
  <div class="study-shell ion-padding app-text-select">
    <ion-item class="study-state study-state--error" lines="none" *ngIf="facade.error">
      <ion-label>{{ facade.error }}</ion-label>
    </ion-item>

    <ion-item class="study-state" lines="none" *ngIf="facade.loading">
      <ion-label>Loading lesson study...</ion-label>
    </ion-item>

    <ng-container *ngIf="!facade.loading && !facade.error && facade.lesson">
      <ng-container [ngSwitch]="facade.activeTask">
        <app-study-reading-tab *ngSwitchCase="'reading'" [ayahs]="facade.readingAyahs"></app-study-reading-tab>

        <app-study-morphology-tab
          *ngSwitchCase="'morphology'"
          [unitId]="facade.studyUnitId"
          [rangeRef]="facade.studyRangeRef"
          [nouns]="facade.morphologyNouns"
          [verbs]="facade.morphologyVerbs"
          [morphologyItems]="facade.morphologyRawItems"
          [lexiconMorphologyItems]="facade.lexiconMorphologyItems"
          [evidenceItems]="facade.morphologyEvidenceItems"
        ></app-study-morphology-tab>

        <app-study-sentence-structure-tab
          *ngSwitchCase="'sentence_structure'"
          [unitId]="facade.studyUnitId"
          [rangeRef]="facade.studyRangeRef"
          [entries]="facade.sentenceEntries"
        ></app-study-sentence-structure-tab>

        <app-study-expressions-tab
          *ngSwitchCase="'expressions'"
          [cards]="facade.expressionStudyCards"
          [referenceBadge]="facade.passageReferenceBadge"
        ></app-study-expressions-tab>

        <app-study-comprehension-tab
          *ngSwitchCase="'comprehension'"
          [unitId]="facade.studyUnitId"
          [rangeRef]="facade.studyRangeRef"
          [total]="facade.comprehensionQuestionTotal"
          [groups]="facade.comprehensionQuestionGroups"
        ></app-study-comprehension-tab>

        <app-study-passage-structure-tab
          *ngSwitchCase="'passage_structure'"
          [unitId]="facade.studyUnitId"
          [rangeRef]="facade.studyRangeRef"
          [headerTitle]="facade.passageHeaderTitle"
          [headerSubtitle]="facade.passageHeaderSubtitle"
          [sections]="facade.passageStructureSections"
          [toSegments]="facade.toPassageTextSegments.bind(facade)"
          [resolveIcon]="facade.resolveSectionIcon.bind(facade)"
        ></app-study-passage-structure-tab>
      </ng-container>
    </ng-container>
  </div>
</ion-content>

<ion-footer class="study-footer">
  <ion-tab-bar class="study-tab-bar" slot="bottom">
    <ion-tab-button
      class="study-tab-button"
      *ngFor="let tab of taskTabs; trackBy: trackByTask"
      [tab]="tab.key"
      [selected]="facade.activeTask === tab.key"
      [attr.aria-label]="tab.label"
      [title]="tab.label"
      (click)="onTaskSelect(tab.key, $event)"
    >
      <ion-icon [icon]="tab.icon" aria-hidden="true"></ion-icon>
    </ion-tab-button>
  </ion-tab-bar>
</ion-footer>
