<ng-container *ngIf="uniqueQuestion.choices as checkQuestionsChoices; else empty">
  <ng-container *ngIf="checkForm?.controls?.choice?.controls">
    <form [formGroup]="checkForm">
      <div *ngIf="(uniqueQuestion?.check_name | meaning) !== '!NOTHING_LABEL!'" class="col-12 p-2">
        <strong>{{ uniqueQuestion?.check_name | meaning }}</strong>
      </div>

      <ng-container formGroupName="choice">
        <div *ngFor="let current of checkQuestionsChoices; let index = index" class="row m-0 minh25" (click)="doChangeCheckPath('.choice.choice_attachment')">
          <div class="col-12 row pr-0">
            <label
              class="col p-0 pl-2 m-1 minh25 bg-white mb-1 text-left d-flex align-items-center"
              [class.notvalid]="!checkForm?.controls?.choice?.controls?.choice_id?.valid && !checkForm?.controls?.choice?.controls?.choice_id?.pristine"
              [class.selected]="checkForm?.value?.choice?.choice_id === current?._id"
            >
              <i *ngIf="checkForm?.controls?.choice?.controls?.choice_id?.value === current?._id" class="fal fa-check-circle h5 pr-1 text-success m-0"></i>
              <i *ngIf="!(choosedId === current?._id)" class="fal fa-circle h5 pr-1 text-secondary m-0"></i>
              <input type="radio" class="d-none" [value]="current?._id" formControlName="choice_id" />
              {{ current.choice | meaning }}
            </label>
            <button
              [disabled]="!current?.choice_attachment || !(choosedId === current?._id)"
              [class.notvalid]="current?.choice_attachment?.required === true && checkForm?.value?.choice?.choice_attachment?.length === 0 && choosedId === current?._id"
              class="btn btn-icon btn-sm col-1 m-1"
              [class.bg-white]="current?.choice_attachment"
              (click)="showAttachment(current?._id)"
            >
              <i *ngIf="current?.choice_attachment" class="fas fa-camera-alt fa-sm cursor-pointer">
                <span *ngIf="choosedId === current?._id && checkForm?.value?.choice?.choice_attachment?.length > 0" class="my-badge">{{
                  checkForm?.controls?.choice?.controls?.choice_attachment?.value?.length > 9 ? '9+' : checkForm?.controls?.choice?.controls?.choice_attachment?.value?.length
                }}</span>
                <span *ngIf="current?.choice_attachment?.required === true"> *</span>
              </i>
            </button>
            <button
              [disabled]="!current?.choice_comment || !(choosedId === current?._id)"
              [class.notvalid]="current?.choice_comment?.required === true && checkForm?.value?.choice?.choice_comment?.length === 0 && choosedId === current?._id"
              class="btn btn-icon btn-sm col-1 m-1"
              [class.bg-white]="current?.choice_comment"
              (click)="showComment(current?._id)"
            >
              <i *ngIf="current?.choice_comment" class="fas fa-comment-plus fa-sm cursor-pointer">
                <span *ngIf="choosedId === current?._id && checkForm?.value?.choice?.choice_comment?.length > 0" class="my-badge">&#10004;</span>
                <span *ngIf="current?.choice_comment?.required === true"> *</span>
              </i>
            </button>
          </div>
          <mcit-subchecks
            class="col"
            *ngIf="choosedId === current?._id && checkForm?.controls?.choice?.controls?.choice_subcheck?.controls?.type.value !== null"
            [subcheckForm]="checkForm?.controls?.choice"
            [localMode]="localMode"
            [localAttachmentsDirectoryName]="localAttachmentsDirectoryName"
            [subcheckQuestion]="current?.choice_subcheck"
            [environment]="environment"
            [isEditable$]="isEditable$"
            [forceA4]="forceA4"
            [baseUrl]="baseUrl"
            [prefix_attach_url]="prefix_attach_url"
            [suffix_attach_url]="suffix_attach_url"
            [actions$]="actions$"
            (attachAdded)="onAttachAdded($event)"
            (checkPathChanged)="onCheckPathChanged('.choice', $event)"
          ></mcit-subchecks>
          <div class="col-12" *ngIf="(choosedId === attachmentShownId || checkForm?.value?.choice?.choice_attachment?.length > 0) && choosedId === current?._id && current?.choice_attachment">
            <div class="m-1 pl-1 my-sub-text">
              <em *ngIf="current?.choice_attachment?.required === true"> {{ 'INSPECTIONS.CHECKS.MANDATORY_PICTURE' | translate }}</em>
            </div>
            <mcit-attachments
              [localMode]="localMode"
              [directoryName]="localAttachmentsDirectoryName"
              [attachments]="checkForm?.value?.choice?.choice_attachment"
              (attachlistChanged)="onChoiceAttachListChanged($event)"
              (attachAdded)="onAttachAdded($event)"
              [environment]="environment"
              [editable]="isEditable$ | async"
              [forceGrid4]="forceA4"
              [baseUrl]="prefix_attach_url || baseUrl"
              [suffixUrl]="suffix_attach_url"
              [actions$]="actions$"
            >
            </mcit-attachments>
          </div>
          <div class="col-12" *ngIf="(choosedId === commentShownId || checkForm?.value?.choice?.choice_comment?.length > 0) && choosedId === current?._id && current?.choice_comment">
            <textarea
              class="col-12 p-1 border"
              rows="2"
              formControlName="choice_comment"
              placeholder="{{ (current?.choice_comment?.required === true ? 'INSPECTIONS.CHECKS.MANDATORY_COMMENTS' : 'INSPECTIONS.CHECKS.COMMENTS') | translate }}"
            ></textarea>
          </div>
        </div>
      </ng-container>
    </form>
  </ng-container>
</ng-container>

<ng-template #empty>
  <div class="d-flex flex-column justify-content-center h-100">
    <h4>class="text-center">{{ 'COMMON.EMPTY_DATA' | translate }}</h4>
  </div>
</ng-template>
