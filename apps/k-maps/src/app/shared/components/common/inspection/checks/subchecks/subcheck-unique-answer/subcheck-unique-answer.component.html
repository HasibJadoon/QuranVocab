<ng-container *ngIf="uniqueSubcheckQuestion?.choices as subcheckChoices; else empty">
  <ng-container *ngIf="subcheckForm?.controls">
    <form [formGroup]="subcheckForm">
      <div *ngIf="(uniqueSubcheckQuestion?.subcheck_name | meaning) !== '!NOTHING_LABEL!'" class="col-12 p-2">
        <strong>{{ uniqueSubcheckQuestion?.subcheck_name | meaning }}</strong>
      </div>

      <ng-container formGroupName="choice">
        <div *ngFor="let current of subcheckChoices; let index = index" class="row m-0 minh25">
          <label
            class="col mr-1 mt-1 mb-1 p-0 pl-2 bg-white d-flex align-items-center minh25"
            [class.notvalid]="!subcheckForm?.controls?.choice?.controls?.choice_id?.valid && !subcheckForm?.controls?.choice?.controls?.choice_id?.pristine"
            [class.selected]="choosedId === current?._id"
          >
            <i *ngIf="choosedId === current?._id" class="fas fa-check-circle pr-1 text-success h5 m-0"></i>
            <i *ngIf="!(choosedId === current?._id)" class="fas fa-circle pr-1 text-secondary h5 m-0"></i>
            <input class="m-1 ml-2 d-none" type="radio" [value]="current?._id" formControlName="choice_id" />
            {{ current.choice | meaning }}
          </label>

          <button
            [disabled]="!current?.choice_attachment || !(choosedId === current?._id)"
            [class.notvalid]="current?.choice_attachment?.required === true && subcheckForm?.value?.choice?.choice_attachment?.length === 0 && choosedId === current?._id"
            class="btn btn-icon btn-sm col-1 m-1"
            [class.bg-white]="current?.choice_attachment"
            (click)="showAttachment(current?._id)"
          >
            <i *ngIf="current?.choice_attachment" class="fas fa-camera-alt fa-sm cursor-pointer">
              <span *ngIf="choosedId === current?._id && subcheckForm?.value?.choice?.choice_attachment?.length > 0" class="my-badge">{{
                subcheckForm?.value?.choice?.choice_attachment?.length > 9 ? '9+' : subcheckForm?.value?.choice?.choice_attachment?.length
              }}</span>
              <span *ngIf="current?.choice_attachment?.required === true"> *</span>
            </i>
          </button>
          <button
            [disabled]="!current?.choice_comment || !(choosedId === current?._id)"
            [class.notvalid]="current?.choice_comment?.required === true && subcheckForm?.value?.choice?.choice_comment?.length === 0 && choosedId === current?._id"
            class="btn btn-icon btn-sm col-1 m-1"
            [class.bg-white]="current?.choice_comment"
            (click)="showComment(current?._id)"
          >
            <i *ngIf="current?.choice_comment" class="fas fa-comment-plus fa-sm cursor-pointer">
              <span *ngIf="choosedId === current?._id && subcheckForm?.value?.choice?.choice_comment?.length > 0" class="my-badge">&#10004;</span>
              <span *ngIf="current?.choice_comment?.required === true"> *</span>
            </i>
          </button>
          <div class="col-12">
            <ng-container *ngIf="(choosedId === attachmentShownId || subcheckForm?.value?.choice?.choice_attachment?.length > 0) && choosedId === current?._id">
              <mcit-attachments
                [localMode]="localMode"
                [directoryName]="localAttachmentsDirectoryName"
                [attachments]="subcheckForm?.value?.choice?.choice_attachment"
                (attachlistChanged)="onChoiceAttachListChanged($event)"
                (attachAdded)="onAttachAdded($event)"
                [environment]="environment"
                [editable]="isEditable$ | async"
                [forceGrid4]="forceA4"
                [baseUrl]="prefix_attach_url || baseUrl"
                [suffixUrl]="suffix_attach_url"
                [actions$]="actions$"
              >
              </mcit-attachments>
            </ng-container>
          </div>
          <div class="col-12">
            <ng-container *ngIf="(choosedId === commentShownId || subcheckForm?.value?.choice?.choice_comment?.length > 0) && choosedId === current?._id">
              <textarea
                class="col-12 p-1 border"
                rows="2"
                formControlName="choice_comment"
                placeholder="{{ (current?.choice_comment?.required === true ? 'INSPECTIONS.CHECKS.MANDATORY_COMMENTS' : 'INSPECTIONS.CHECKS.COMMENTS') | translate }}"
              ></textarea>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </form>
  </ng-container>
</ng-container>

<ng-template #empty>
  <div class="d-flex flex-column justify-content-center h-100">
    <h4 class="text-center">{{ 'COMMON.EMPTY_DATA' | translate }}</h4>
  </div>
</ng-template>
