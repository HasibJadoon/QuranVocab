<div class="step-section">
  <p class="status-banner info" *ngIf="!state.lessonId">
    Save lesson metadata before adding tasks.
  </p>

  <div class="task-layout" [class.task-layout--top]="readOnly">
    <app-tabs
      class="task-tabs"
      [tabs]="taskTabsForNav"
      [activeId]="activeTabId"
      variant="pills"
      [orientation]="readOnly ? 'horizontal' : 'vertical'"
      ariaLabel="Task types"
      [primaryIds]="navPrimaryIds"
      overflowLabel="More Tasks"
      (tabChange)="onTaskTabChange($event)"
    ></app-tabs>

    <div class="task-editor" *ngIf="readOnly && activeTabId === 'lesson'">
      <div class="task-meta">
        <span>Lesson overview</span>
        <span>Surah {{ state.selectedSurah || '--' }} Ayah {{ rangeLabelShort }}</span>
      </div>

      <div class="lesson-grid">
        <article class="lesson-card">
          <h4>{{ lessonHeading }}</h4>
          <p class="note-muted">{{ lessonDetail }}</p>
          <div class="field-row">
            <div class="rule-card">
              <strong>Episode Intro</strong>
              <span>{{ episodeIntro }}</span>
            </div>
            <div class="rule-card">
              <strong>Scene</strong>
              <span>{{ sceneDetail }}</span>
            </div>
            <div class="rule-card">
              <strong>Aesthetic</strong>
              <span>{{ sceneAesthetic }}</span>
            </div>
          </div>
        </article>
      </div>
    </div>

    <div class="task-editor" *ngIf="(!readOnly || activeTabId !== 'lesson') && activeTaskTab as tab">
      <div class="task-meta">
        <span>Linked unit: Surah {{ state.selectedSurah || '--' }} Ayah {{ rangeLabelShort }}</span>
        <span>{{ readOnly ? 'Study mode' : 'Task type:' }} {{ tab.label }}</span>
      </div>
      <ng-container [ngSwitch]="tab.type">
        <app-reader-task *ngSwitchCase="'reading'" [readOnly]="readOnly"></app-reader-task>
        <app-sentence-structure-task
          *ngSwitchCase="'sentence_structure'"
          [readOnly]="readOnly"
        ></app-sentence-structure-task>
        <app-morphology-task *ngSwitchCase="'morphology'" [readOnly]="readOnly"></app-morphology-task>
        <app-grammar-concepts-task
          *ngSwitchCase="'grammar_concepts'"
          [readOnly]="readOnly"
        ></app-grammar-concepts-task>
        <app-expressions-task *ngSwitchCase="'expressions'" [readOnly]="readOnly"></app-expressions-task>
        <app-comprehension-task *ngSwitchCase="'comprehension'" [readOnly]="readOnly"></app-comprehension-task>
        <app-passage-structure-task
          *ngSwitchCase="'passage_structure'"
          [readOnly]="readOnly"
        ></app-passage-structure-task>
      </ng-container>
    </div>
  </div>

  <p *ngIf="state.statusMessage" class="status-banner" [ngClass]="state.statusTone">
    {{ state.statusMessage }}
  </p>
</div>
