<div class="sentence-layout">
  <app-tabs
    class="sentence-tabs"
    [tabs]="tabs"
    [activeId]="activeTabId"
    variant="tabs"
    ariaLabel="Grammar concepts task tabs"
    (tabChange)="onTabChange($event)"
  ></app-tabs>

  <div class="sentence-pane">
    <ng-container *ngIf="activeTabId === 'items'">
      <div class="sentence-card">
        <div class="sentence-card-head">
          <h4>Grammar Concepts (from Sentence Structure)</h4>
          <div class="action-row" *ngIf="!readOnly">
            <button type="button" class="btn btn-ghost btn-sm" (click)="loadFromSentenceStructure()">
              Load from Sentence Structure
            </button>
          </div>
        </div>
        <p class="note-muted">
          Extracts grammar references from sentence structure summaries to build a high-level concept list
          for this passage.
        </p>

        <div class="table-wrap table-responsive app-crud-table-shell" *ngIf="conceptGroups.length; else noConcepts">
          <table class="table align-middle app-crud-table editor-table">
            <thead>
              <tr>
                <th>Concept</th>
                <th class="sentences-col">Sentences</th>
                <th class="remove-col" *ngIf="!readOnly"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let group of conceptGroups">
                <td class="concept-cell">
                  <div class="concept-row-head">
                    <span class="concept-chip">{{ group.label }}</span>
                  </div>
                </td>
                <td class="sentences-col">
                  <div class="concept-sentences">
                    <div class="concept-sentence text-arabic" dir="rtl" *ngFor="let sentence of group.sentences">
                      {{ sentence }}
                    </div>
                    <div class="concept-sentence text-muted" *ngIf="!group.sentences.length">—</div>
                  </div>
                </td>
                <td class="remove-col" *ngIf="!readOnly">
                  <button
                    type="button"
                    class="btn btn-ghost btn-sm concept-remove-btn"
                    (click)="removeItem(group.itemIndex)"
                  >
                    Remove
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <ng-template #noConcepts>
          <p class="text-muted">
            {{
              readOnly
                ? 'No grammar concepts are available for this lesson yet.'
                : 'No grammar concepts in the task yet. Click “Load from Sentence Structure”.'
            }}
          </p>
        </ng-template>
      </div>
    </ng-container>

    <ng-container *ngIf="activeTabId === 'json'">
      <app-quran-lesson-task-json taskType="grammar_concepts" [readOnly]="readOnly"></app-quran-lesson-task-json>
    </ng-container>
  </div>
</div>
