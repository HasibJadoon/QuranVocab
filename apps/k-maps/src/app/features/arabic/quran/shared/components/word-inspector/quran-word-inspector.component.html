<aside
  class="quran-word-inspector"
  [class.quran-word-inspector--empty]="!hasSelection"
  [class.quran-word-inspector--panel]="appearance === 'panel'"
>
  <header class="inspector-header">
    <div class="inspector-copy">
      <p class="inspector-kicker" *ngIf="appearance !== 'panel'">Word Insight</p>
      <h3 class="inspector-word text-arabic" dir="rtl">{{ activeWord }}</h3>
      <p class="inspector-meta">
        <span>{{ activeSurahReferenceLabel }}</span>
        <span *ngIf="contextLabel">{{ contextLabel }}</span>
      </p>
    </div>
    <button
      *ngIf="hasSelection && appearance !== 'panel'"
      type="button"
      class="inspector-close"
      aria-label="Close word insights"
      (click)="requestClose()"
    >
      ×
    </button>
  </header>

  <ng-container *ngIf="hasSelection; else emptyStateTpl">
    <nav class="inspector-tabs" role="tablist" aria-label="Word inspector tabs">
      <button
        type="button"
        role="tab"
        class="tab-btn"
        [class.active]="activeTab === 'lexicon'"
        [attr.aria-selected]="activeTab === 'lexicon'"
        (click)="setActiveTab('lexicon')"
      >
        Lexicon
      </button>
      <button
        type="button"
        role="tab"
        class="tab-btn"
        [class.active]="activeTab === 'morphology'"
        [attr.aria-selected]="activeTab === 'morphology'"
        (click)="setActiveTab('morphology')"
      >
        Morphology
      </button>
      <button
        type="button"
        role="tab"
        class="tab-btn"
        [class.active]="activeTab === 'evidence'"
        [attr.aria-selected]="activeTab === 'evidence'"
        (click)="setActiveTab('evidence')"
      >
        Evidence ({{ evidenceCount }})
      </button>
    </nav>

    <div class="inspector-body" [ngSwitch]="activeTab">
      <section *ngSwitchCase="'lexicon'" class="tab-section">
        <div class="loading-state" *ngIf="remoteLoading && resolvedLexiconId">
          Loading {{ resolvedLexiconId }} details...
        </div>
        <div class="error-state" *ngIf="remoteError">{{ remoteError }}</div>

        <ng-container *ngIf="hasLexiconData; else noLexiconTpl">
          <ng-container *ngIf="appearance === 'panel'; else lexiconClassicTpl">
            <article class="insight-card insight-card--word">
              <div class="insight-word-head">
                <h4 class="insight-word text-arabic" dir="rtl">{{ activeWord }}</h4>
                <span class="insight-pos-badge" *ngIf="posBadge">{{ posBadge }}</span>
              </div>
              <p class="insight-translit" *ngIf="transliterationValue">{{ transliterationValue }}</p>
              <p class="insight-meaning">{{ primaryMeaning }}</p>
              <div class="key-badge-list" *ngIf="keyInfoBadges.length">
                <p class="key-badge-title">Key Information</p>
                <span class="key-badge" *ngFor="let badge of keyInfoBadges; trackBy: trackByBadge">
                  <span class="key-badge-label">{{ badge.label }}</span>
                  <span class="key-badge-value" [class.qi-ar]="badge.arabic" [attr.dir]="badge.arabic ? 'rtl' : null">{{ badge.value }}</span>
                </span>
              </div>
            </article>

            <article class="insight-card">
              <p class="terms-label">Meanings</p>
              <div class="meaning-stack">
                <p class="meaning-item">
                  <span class="meaning-index">1</span>
                  <span
                    class="meaning-text"
                    [class.meaning-text--arabic]="isArabicText(primaryMeaning)"
                    [attr.dir]="isArabicText(primaryMeaning) ? 'rtl' : null"
                  >
                    {{ primaryMeaning }}
                  </span>
                </p>
                <p class="meaning-item" *ngIf="secondaryMeaning">
                  <span class="meaning-index">2</span>
                  <span
                    class="meaning-text"
                    [class.meaning-text--arabic]="isArabicText(secondaryMeaning)"
                    [attr.dir]="isArabicText(secondaryMeaning) ? 'rtl' : null"
                  >
                    {{ secondaryMeaning }}
                  </span>
                </p>
              </div>
            </article>

            <article class="insight-card insight-card--example" *ngIf="featuredEvidenceExample as example">
              <p class="terms-label">Example</p>
              <h5 class="example-title">{{ example.title }}</h5>
              <p class="example-text" [class.qi-ar]="isArabicText(example.text)" [attr.dir]="isArabicText(example.text) ? 'rtl' : null">
                {{ example.text }}
              </p>
              <p class="example-source">{{ example.source }}</p>
            </article>

            <article class="insight-card">
              <p class="terms-label">Linguistic Profile</p>
              <div class="insight-pairs">
                <div class="insight-pair" *ngFor="let pair of lexicalInsightPairs; trackBy: trackByPair">
                  <span class="insight-pair-label">{{ pair.label }}</span>
                  <span class="insight-pair-value" [class.field-value--arabic]="pair.arabic" [attr.dir]="pair.arabic ? 'rtl' : null">
                    {{ pair.value }}
                  </span>
                </div>
              </div>
            </article>

            <article class="insight-card" *ngIf="semanticChips.length">
              <p class="terms-label">Semantic Range</p>
              <div class="terms-list">
                <span
                  class="term-pill"
                  *ngFor="let term of semanticChips; trackBy: trackByTerm"
                  [class.qi-ar]="isArabicText(term)"
                  [attr.dir]="isArabicText(term) ? 'rtl' : null"
                >
                  {{ term }}
                </span>
              </div>
            </article>
          </ng-container>
          <ng-template #lexiconClassicTpl>
            <div class="field-grid">
              <div class="field-row" *ngFor="let field of lexiconFields; trackBy: trackByField">
                <span class="field-label">{{ field.label }}</span>
                <span class="field-value" [class.field-value--arabic]="field.arabic" [attr.dir]="field.arabic ? 'rtl' : null">
                  {{ field.value }}
                </span>
              </div>
            </div>

            <div class="terms-wrap" *ngIf="relatedTerms.length">
              <p class="terms-label">Related</p>
              <div class="terms-list">
                <span class="term-pill" *ngFor="let term of relatedTerms; trackBy: trackByTerm">{{ term }}</span>
              </div>
            </div>
          </ng-template>
        </ng-container>
        <ng-template #noLexiconTpl>
          <p class="empty-inline">No lexicon details available for this word yet.</p>
        </ng-template>
      </section>

      <section *ngSwitchCase="'morphology'" class="tab-section">
        <div class="loading-state" *ngIf="remoteLoading && resolvedLexiconId">
          Fetching morphology for {{ resolvedLexiconId }}...
        </div>
        <div class="error-state" *ngIf="remoteError">{{ remoteError }}</div>

        <ng-container *ngIf="hasMorphologyCardData; else noMorphologyTpl">
          <article class="morphology-card morphology-card--detail">
            <header class="morphology-head">
              <h4 class="morphology-word text-arabic" dir="rtl" translate="no">{{ morphologyCardWord }}</h4>
              <p class="morphology-meta">
                <span class="morphology-meta-label">Root:</span>
                <span class="morphology-meta-value text-arabic" dir="rtl" translate="no">{{ morphologyCardWord }}</span>
                <span class="morphology-meta-root-tag">(root)</span>
                <span *ngIf="morphologyCardDerivationType">•</span>
                <span *ngIf="morphologyCardDerivationType" class="text-arabic" dir="rtl" translate="no">{{ morphologyCardDerivationType }}</span>
              </p>
              <div class="morphology-pill-row" *ngIf="morphologyHeaderPills.length">
                <span class="term-pill morphology-pill" *ngFor="let pill of morphologyHeaderPills; trackBy: trackByTerm">{{ pill }}</span>
              </div>
            </header>

            <div class="morphology-table">
              <p class="morphology-table-row">
                <span class="morphology-table-label">Singular:</span>
                <span class="morphology-table-value text-arabic" dir="rtl" translate="no">
                  {{ morphologySingularForm || '—' }}
                  <span class="morphology-inline-note" *ngIf="morphologySingularPattern">({{ morphologySingularPattern }})</span>
                </span>
              </p>
              <p class="morphology-table-row">
                <span class="morphology-table-label">Plural:</span>
                <span class="morphology-table-value text-arabic" dir="rtl" translate="no">
                  {{ morphologyPluralForm || '—' }}
                  <span class="morphology-inline-note" *ngIf="morphologyPluralPattern">({{ morphologyPluralPattern }})</span>
                </span>
              </p>
              <p class="morphology-table-row" *ngIf="morphologyPluralType">
                <span class="morphology-table-label">Type:</span>
                <span class="morphology-table-value text-arabic" dir="rtl" translate="no">{{ morphologyPluralType }}</span>
              </p>
              <p class="morphology-table-row" *ngIf="morphologyDerivedTriplet">
                <span class="morphology-table-label">Derived From:</span>
                <span class="morphology-table-value text-arabic" dir="rtl" translate="no">{{ morphologyDerivedTriplet }}</span>
              </p>
            </div>

            <section class="morphology-block" *ngIf="morphologyFeatureBadges.length">
              <p class="morphology-section-label">Features:</p>
              <div class="morphology-pill-row">
                <span class="term-pill morphology-pill" *ngFor="let feature of morphologyFeatureBadges; trackBy: trackByTerm">
                  {{ feature }}
                </span>
              </div>
            </section>

            <section class="morphology-block" *ngIf="morphologyCardMeanings.length">
              <p class="morphology-section-label">Meanings:</p>
              <div class="morphology-pill-row morphology-pill-row--meanings">
                <span class="term-pill morphology-pill morphology-pill--meaning" *ngFor="let meaning of morphologyCardMeanings; trackBy: trackByTerm">
                  {{ meaning }}
                </span>
              </div>
            </section>
          </article>
        </ng-container>
        <ng-template #noMorphologyTpl>
          <p class="empty-inline">No morphology details available for this word yet.</p>
        </ng-template>
      </section>

      <section *ngSwitchCase="'evidence'" class="tab-section">
        <div class="loading-state" *ngIf="remoteLoading && resolvedLexiconId">
          Fetching all evidence for {{ resolvedLexiconId }}...
        </div>
        <div class="error-state" *ngIf="remoteError">{{ remoteError }}</div>

        <ng-container *ngIf="evidenceDisplayRecords.length; else noEvidenceTpl">
          <div class="evidence-list" [class.evidence-list--panel]="appearance === 'panel'">
            <article class="evidence-card evidence-card--panel" *ngFor="let evidence of evidenceDisplayRecords; trackBy: trackByEvidence">
              <p class="evidence-kind">{{ evidenceGroupTitle(evidence) }}</p>
              <ng-container *ngIf="evidenceMetaPills(evidence) as metaPills">
                <div class="evidence-meta-pills" *ngIf="metaPills.length">
                  <span class="term-pill evidence-meta-pill" *ngFor="let pill of metaPills; trackBy: trackByEvidencePill">
                    <span class="evidence-meta-key">{{ pill.label }}</span>
                    <span class="evidence-meta-value">{{ pill.value }}</span>
                  </span>
                </div>
              </ng-container>
              <p class="evidence-extract evidence-text">{{ evidenceExtractText(evidence) }}</p>
            </article>
          </div>
        </ng-container>
        <ng-template #noEvidenceTpl>
          <p class="empty-inline">No evidence is linked to this word yet.</p>
        </ng-template>
      </section>
    </div>
  </ng-container>

  <ng-template #emptyStateTpl>
    <div class="empty-state">
      <h4>Select a word</h4>
      <p>Click any Qur'an word to open Lexicon, Morphology, and Evidence details.</p>
    </div>
  </ng-template>
</aside>
