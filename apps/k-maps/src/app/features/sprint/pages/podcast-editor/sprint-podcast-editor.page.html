<section class="podcast-editor-page">
  <header class="editor-header">
    <div>
      <p class="kicker">Podcast Episode</p>
      <h1>{{ episode?.title || 'Podcast Editor' }}</h1>
      <p>Outline + script + checklist + refs</p>
    </div>

    <button class="primary-btn" type="button" (click)="save()" [disabled]="saving() || !episode">
      {{ saving() ? 'Saving...' : 'Save' }}
    </button>
  </header>

  @if (error()) {
    <p class="error-msg">{{ error() }}</p>
  }

  @if (saved()) {
    <p class="saved-msg">Episode saved.</p>
  }

  @if (loading()) {
    <div class="loading">Loading episode...</div>
  } @else if (episode) {
    <section class="editor-grid">
      <aside class="panel">
        <header>
          <h2>Outline Sections</h2>
        </header>

        <div class="add-row">
          <input [formControl]="outlineInputControl" placeholder="Add section" (keydown.enter)="addOutlineItem()" />
          <button type="button" class="ghost-btn" (click)="addOutlineItem()">Add</button>
        </div>

        @for (item of outline; track item.id; let idx = $index) {
          <div class="outline-row">
            <input [(ngModel)]="item.title" [name]="'outline-' + idx" />
            <div class="outline-actions">
              <button type="button" class="mini-btn" (click)="moveOutline(idx, -1)">↑</button>
              <button type="button" class="mini-btn" (click)="moveOutline(idx, 1)">↓</button>
              <button type="button" class="mini-btn" (click)="removeOutline(idx)">✕</button>
            </div>
          </div>
        }
      </aside>

      <main class="panel">
        <header>
          <h2>Script (Markdown)</h2>
        </header>

        <textarea [(ngModel)]="scriptText" name="script-markdown" rows="24" placeholder="Write episode script..."></textarea>
      </main>

      <aside class="panel right-side">
        <header>
          <h2>Capture Idea</h2>
        </header>

        <div class="add-row">
          <input [formControl]="ideaControl" placeholder="Quick idea..." (keydown.enter)="captureIdea()" />
          <button type="button" class="ghost-btn" (click)="captureIdea()">Capture</button>
        </div>

        <section class="sub-panel">
          <h3>Checklist</h3>
          <div class="add-row">
            <input [formControl]="checklistInputControl" placeholder="Add checklist item" (keydown.enter)="addChecklistItem()" />
            <button type="button" class="mini-btn" (click)="addChecklistItem()">Add</button>
          </div>

          @for (item of checklist; track item.id; let idx = $index) {
            <label class="check-row">
              <input type="checkbox" [(ngModel)]="item.done" [name]="'check-done-' + idx" />
              <input [(ngModel)]="item.label" [name]="'check-label-' + idx" />
              <button type="button" class="mini-btn" (click)="removeChecklist(idx)">✕</button>
            </label>
          }
        </section>

        <section class="sub-panel">
          <h3>refs_json</h3>
          <textarea
            [(ngModel)]="refsJsonText"
            name="refs-json"
            rows="10"
            placeholder="Example refs: surah 12, ayah 1-3"
          ></textarea>
        </section>
      </aside>
    </section>
  }
</section>
