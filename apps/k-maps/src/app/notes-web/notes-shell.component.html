<section class="notes-shell">
  <button
    type="button"
    class="capture-fab"
    aria-label="Capture note"
    title="Capture note"
    (click)="openCaptureModal()"
  >
    +
  </button>

  <aside class="notes-panel">
    <app-notes-list
      [notes]="notes()"
      [selectedId]="selectedId()"
      [status]="status()"
      [query]="query()"
      [loading]="loading()"
      [creating]="creating()"
      (statusChanged)="onStatusChanged($event)"
      (queryChanged)="onQueryChanged($event)"
      (noteSelected)="selectNote($event)"
      (createRequested)="openCaptureModal()"
    ></app-notes-list>

    @if (listError()) {
      <p class="list-error">{{ listError() }}</p>
    }
  </aside>

  <main class="editor-panel">
    <app-note-editor
      [noteId]="selectedId()"
      (draftChanged)="onDraftChanged($event)"
      (notePatched)="onNotePatched($event)"
      (noteStatusChanged)="onNoteStatusChanged($event)"
    ></app-note-editor>
  </main>
</section>

@if (captureOpen()) {
  <div
    class="capture-modal-backdrop"
    role="dialog"
    aria-modal="true"
    aria-labelledby="capture-note-title"
    (click)="closeCaptureModal()"
  >
    <div class="capture-modal" (click)="$event.stopPropagation()">
      <header class="capture-modal-header">
        <h3 id="capture-note-title">Capture Note</h3>
        <button type="button" class="capture-close" aria-label="Close" (click)="closeCaptureModal()">Ã—</button>
      </header>

      <textarea
        class="capture-input"
        [formControl]="captureBodyControl"
        placeholder="Write your note..."
        rows="7"
        autofocus
        (keydown)="onCaptureKeydown($event)"
      ></textarea>

      @if (captureError()) {
        <p class="capture-error">{{ captureError() }}</p>
      }

      <footer class="capture-modal-footer">
        <button type="button" class="modal-btn ghost" (click)="closeCaptureModal()" [disabled]="creating()">
          Cancel
        </button>
        <button
          type="button"
          class="modal-btn primary"
          (click)="submitCaptureNote()"
          [disabled]="creating() || !captureBodyControl.value.trim()"
        >
          {{ creating() ? 'Saving...' : 'Save note' }}
        </button>
      </footer>
    </div>
  </div>
}
