<section class="targeted-notes-panel">
  <header class="targeted-notes-head">
    <h3>Notes</h3>
    <button type="button" class="refresh-btn" (click)="refresh()" [disabled]="loading() || adding()">
      Refresh
    </button>
  </header>

  @if (loading()) {
    <div class="notes-state">Loading notes...</div>
  } @else {
    @if (notes().length > 0) {
      <ul class="notes-list">
        @for (note of notes(); track trackById($index, note)) {
          <li class="note-item">
            <h4>{{ titleFor(note) }}</h4>
            <p>{{ previewFor(note) }}</p>
            <time>{{ note.updated_at | date: 'MMM d, h:mm a' }}</time>
          </li>
        }
      </ul>
    } @else {
      <div class="notes-state">No notes yet for this target.</div>
    }
  }

  <div class="composer-wrap">
    <textarea
      [(ngModel)]="bodyMd"
      (keydown)="onComposerKeydown($event)"
      rows="3"
      placeholder="Write a note (Ctrl+Enter to add)"
    ></textarea>
    <button type="button" class="add-btn" (click)="addNote()" [disabled]="adding()">
      {{ adding() ? 'Adding...' : 'Add' }}
    </button>
  </div>

  @if (error()) {
    <p class="error-text">{{ error() }}</p>
  }
</section>
